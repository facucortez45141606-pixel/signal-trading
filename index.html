<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Indicador Visual + Mercado Pro</title>
<style>
body {
  font-family: Arial;
  text-align: center;
  background: #0f172a;
  color: white;
  padding: 20px;
}
button {
  background: #22c55e;
  border: none;
  padding: 10px 20px;
  color: white;
  border-radius: 10px;
  margin: 10px;
}
img {
  margin-top: 10px;
  max-width: 90%;
  border-radius: 10px;
}
.result {
  font-size: 1.3em;
  margin-top: 15px;
}
</style>
</head>
<body>

<h2>üìä Analizador de Se√±ales Combinado</h2>

<p>1Ô∏è‚É£ Sube una captura del gr√°fico</p>
<input type="file" id="upload" accept="image/*">
<br>
<img id="preview" src="">

<p>2Ô∏è‚É£ Elige una criptomoneda para verificar datos reales:</p>
<select id="symbol">
  <option value="BTCUSDT">Bitcoin (BTC/USDT)</option>
  <option value="ETHUSDT">Ethereum (ETH/USDT)</option>
  <option value="BNBUSDT">BNB (BNB/USDT)</option>
</select>

<br><button onclick="analyze()">Analizar Se√±ales</button>

<div id="result" class="result"></div>

<script>
const upload = document.getElementById("upload");
const preview = document.getElementById("preview");
upload.onchange = () => {
  const file = upload.files[0];
  if (file) {
    const reader = new FileReader();
    reader.onload = e => preview.src = e.target.result;
    reader.readAsDataURL(file);
  }
};

async function analyze() {
  const result = document.getElementById("result");
  const symbol = document.getElementById("symbol").value;

  result.innerHTML = "Analizando imagen y mercado... ‚è≥";

  // --- An√°lisis visual ---
  const canvas = document.createElement("canvas");
  const ctx = canvas.getContext("2d");
  const img = document.getElementById("preview");
  if (!img.src) return result.innerHTML = "‚ö†Ô∏è Sube una imagen antes de analizar.";

  canvas.width = img.naturalWidth;
  canvas.height = img.naturalHeight;
  ctx.drawImage(img, 0, 0);
  const data = ctx.getImageData(0, 0, canvas.width, canvas.height).data;

  let green = 0, red = 0;
  for (let i = 0; i < data.length; i += 4) {
    const [r, g, b] = [data[i], data[i + 1], data[i + 2]];
    if (g > r && g > b) green++;
    if (r > g && r > b) red++;
  }
  const visualSignal = green > red ? "ALCISTA" : red > green ? "BAJISTA" : "NEUTRA";

  // --- Datos reales (Binance) ---
  const res = await fetch(`https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=1h&limit=100`);
  const dataMarket = await res.json();
  const closes = dataMarket.map(c => parseFloat(c[4]));

  const smaShort = closes.slice(-7).reduce((a,b)=>a+b)/7;
  const smaLong = closes.slice(-25).reduce((a,b)=>a+b)/25;
  const rsi = (() => {
    let gains=0, losses=0;
    for (let i=1;i<15;i++){
      const diff=closes[i]-closes[i-1];
      if(diff>=0) gains+=diff; else losses-=diff;
    }
    const rs=gains/(losses||1);
    return 100-100/(1+rs);
  })();

  // --- Fusi√≥n de se√±ales ---
  let final = "‚ö™ NEUTRO";
  if (visualSignal === "ALCISTA" && smaShort > smaLong && rsi < 70) final = "üü¢ COMPRA (coinciden se√±ales alcistas)";
  else if (visualSignal === "BAJISTA" && smaShort < smaLong && rsi > 50) final = "üî¥ VENTA (coinciden se√±ales bajistas)";

  result.innerHTML = `
    <b>${symbol}</b><br>
    Se√±al visual: ${visualSignal}<br>
    RSI: ${rsi.toFixed(1)}<br>
    SMA7: ${smaShort.toFixed(1)} | SMA25: ${smaLong.toFixed(1)}<br><br>
    <b>Resultado:</b> ${final}
  `;
}
</script>

</body>
</html>
